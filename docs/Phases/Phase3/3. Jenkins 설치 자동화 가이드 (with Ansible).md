# Jenkins 설치 자동화 가이드 (with Ansible)

Ansible을 사용하여 OpenStack VM에 Jenkins를 자동으로 설치하고 구성

## 목적

OpenStack VM에 Jenkins를 설치하고, 서비스를 자동 실행 및 부팅 시 시작되도록 구성 (기본 포트: **8080**)

## 작업 디렉토리 이동

```bash
cd ~/ansible-test
```

## jenkins-install.yml 플레이북 작성

```bash
touch jenkins-install.yml
```

**jenkins-install.yml 파일 내용**:

```yaml
---
# Jenkins 설치 및 서비스 시작
- name: Install Jenkins on web server
  hosts: web # 대상 호스트 그룹
  become: yes # root 권한 사용
  
  tasks:
    - name: Install dependencies
      apt:
        name:
          - openjdk-11-jdk # Jenkins가 필요로 하는 Java
          - gnupg
          - curl
        state: present
        update_cache: yes
        
    - name: Add Jenkins GPG key
      apt_key:
        url: https://pkg.jenkins.io/debian-stable/jenkins.io.key
        state: present
        
    - name: Add Jenkins repository
      apt_repository:
        repo: deb https://pkg.jenkins.io/debian-stable binary/
        state: present
        
    - name: Install Jenkins
      apt:
        name: jenkins
        state: present
        update_cache: yes
        
    - name: Start and enable Jenkins
      service:
        name: jenkins
        state: started
        enabled: yes
```

## 실행

```bash
ansible-playbook -i inventory.ini jenkins-install.yml
```

## 설치 완료 후 접속

### 웹 브라우저 접속

```
http://a.b.c.d:8080
```

### 초기 관리자 암호 확인

첫 실행 시 `/var/lib/jenkins/secrets/initialAdminPassword` 파일에서 초기 관리자 암호 확인 필요:

```bash
ssh -i ~/ansible-test/mykey.pem ubuntu@a.b.c.d
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
```

**Ansible로 암호 확인** (선택사항):
```bash
ansible -i inventory.ini web -m shell -a "sudo cat /var/lib/jenkins/secrets/initialAdminPassword" --become
```

## 문제 해결

### Jenkins 서비스 상태 확인

```bash
ansible -i inventory.ini web -m shell -a "sudo systemctl status jenkins"
```

### 포트 8080 접근 불가

보안 그룹에 8080 포트 추가 필요:

```hcl
# Terraform main.tf에 추가
resource "openstack_networking_secgroup_rule_v2" "secgroup_rule_jenkins" {
  direction         = "ingress"
  ethertype         = "IPv4"
  protocol          = "tcp"
  port_range_min    = 8080
  port_range_max    = 8080
  remote_ip_prefix  = "0.0.0.0/0"
  security_group_id = openstack_networking_secgroup_v2.secgroup_ssh.id
}
```

---

**참고**: Jenkins 설치 후 초기 설정을 통해 플러그인 설치 및 관리자 계정을 생성할 수 있음
