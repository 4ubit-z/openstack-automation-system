# Ansible 제어 노드 구성 가이드

OpenStack VM을 Ansible 제어 노드로 구성하여 다른 VM들을 관리할 수 있도록 설정

## 목표

OpenStack VM을 Ansible 제어 노드로 구성하고 기본 연결 테스트 수행

## 1단계: Ansible 설치

제어 노드로 사용할 OpenStack VM에 Ansible 설치:

```bash
sudo apt update
sudo apt upgrade -y
sudo apt install -y ansible
```

설치 확인:

```bash
ansible --version
```

## 2단계: 인벤토리 파일 작성

### 작업 디렉토리 생성

```bash
mkdir -p ~/phase-3 && cd ~/phase-3
```

### inventory.ini 파일 생성

```bash
touch inventory.ini
```

**inventory.ini 파일 내용**:

```ini
[web]
a.b.c.d ansible_user=ubuntu ansible_ssh_private_key_file=/opt/stack/devstack/open.pem
```

**설정 설명**:
- `a.b.c.d`: 대상 VM의 Floating IP
- `ansible_user`: Ubuntu 이미지인 경우 보통 `ubuntu`
- `ansible_ssh_private_key_file`: SSH 키 파일 경로

## 3단계: SSH 키 연결 확인

제어 노드에서 대상 VM으로 직접 SSH 접속 테스트:

```bash
ssh -i /opt/stack/devstack/open.pem ubuntu@a.b.c.d
```

**결과 확인**:
- 정상 접속되면 인증 문제 없음
- 접속 안 될 경우: 권한 문제, 보안 그룹, 사용자 이름 다시 확인

## 4단계: 기본 Ansible 테스트

작업 디렉토리에서 Ansible 테스트 명령 실행:

```bash
ansible -i inventory.ini web -m ping
```

**정상 응답 예시**:

```yaml
a.b.c.d | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
```

## 문제 해결

### SSH 접속 문제

```bash
# 키 파일 권한 확인
ls -l /opt/stack/devstack/open.pem

# known_hosts 파일 정리 (필요시)
ssh-keygen -f "/home/stack/.ssh/known_hosts" -R "a.b.c.d"
```

### Ansible 연결 문제

```bash
# 상세 로그로 디버깅
ansible -i inventory.ini web -m ping -vvv

# 직접 SSH 테스트
ssh -i /opt/stack/devstack/open.pem ubuntu@a.b.c.d
```

---

**참고**: Ansible 제어 노드 구성이 완료되면 다음 단계에서 Playbook을 작성하여 자동화 작업을 진행할 예정
