
Phase 5-2: Grafana ì„¤ì¹˜ ë° ëŒ€ì‹œë³´ë“œ êµ¬ì„± (Prometheus ì—°ë™)
ğŸ¯ ëª©í‘œ

DevStack Host(Ubuntu)ì— Grafanaë¥¼ ì„¤ì¹˜í•œë‹¤. (ê¸°ë³¸ í¬íŠ¸ : 3000)

Prometheus(9091) ë¥¼ ë°ì´í„°ì†ŒìŠ¤ë¡œ ë“±ë¡í•œë‹¤.

Node Exporter Full ëŒ€ì‹œë³´ë“œë¥¼ ì„í¬íŠ¸í•´ VM ë¦¬ì†ŒìŠ¤ë¥¼ ì‹œê°í™”í•œë‹¤.

0) ì „ì œ ì¡°ê±´

Prometheusê°€ DevStack Hostì—ì„œ :9091 ë¡œ ë™ì‘ (ì´ë¯¸ ì™„ë£Œ)

ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ VMì— Node Exporter :9100 ë™ì‘ (ì´ë¯¸ ì™„ë£Œ)

(ë°©í™”ë²½ ì‚¬ìš© ì‹œ) 3000/TCP ì ‘ê·¼ í—ˆìš©

1) Grafana ì„¤ì¹˜ (Ubuntu)
1-1. ê³µì‹ ì €ì¥ì†Œ ì¶”ê°€ í›„ ì„¤ì¹˜(ê¶Œì¥)
# 1) í•„ìˆ˜ ë„êµ¬
sudo apt update
sudo apt install -y software-properties-common curl gnupg

# 2) Grafana GPG í‚¤ & ì €ì¥ì†Œ ì¶”ê°€
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://packages.grafana.com/gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/grafana.gpg
echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://packages.grafana.com/oss/deb stable main" | \
  sudo tee /etc/apt/sources.list.d/grafana.list

# 3) ì„¤ì¹˜ & ì„œë¹„ìŠ¤ ì‹œì‘
sudo apt update
sudo apt install -y grafana
sudo systemctl enable --now grafana-server
sudo systemctl status grafana-server --no-pager


ê¸°ë³¸ ì ‘ì†: http://<DevStack Host IP>:3000
ìµœì´ˆ ë¡œê·¸ì¸: admin / admin â†’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì•ˆë‚´

(ì„ íƒ) í¬íŠ¸ê°€ 3000 ì¶©ëŒ ì‹œ ë³€ê²½
sudo sed -i 's/^;http_port = .*/http_port = 3001/' /etc/grafana/grafana.ini
sudo systemctl restart grafana-server

2) Prometheus ë°ì´í„°ì†ŒìŠ¤ ë“±ë¡

ë¸Œë¼ìš°ì €ì—ì„œ Grafana ì ‘ì† â†’ Login (admin / admin)

ì¢Œì¸¡ Connections â†’ Data sources â†’ Add data source â†’ Prometheus

HTTP URL ì…ë ¥

Grafanaì™€ Prometheusê°€ ê°™ì€ í˜¸ìŠ¤íŠ¸ì´ë©´: http://localhost:9091

ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ì´ë©´: http://<Prometheus-Host-IP>:9091

Save & test (ì„±ê³µ ë©”ì‹œì§€ í™•ì¸)

3) ëŒ€ì‹œë³´ë“œ ì„í¬íŠ¸ (Node Exporter Full)

ì¢Œì¸¡ Dashboards â†’ New â†’ Import

Import via grafana.comì— ID 1860 ì…ë ¥ â†’ Load

Prometheus ë°ì´í„°ì†ŒìŠ¤ ì„ íƒ â†’ Import

ëŒ€ì‹œë³´ë“œê°€ ë¡œë“œë˜ë©´ ìƒë‹¨ì˜ Instance(ë³€ìˆ˜)ì—ì„œ ëª¨ë‹ˆí„°ë§í•  VM ì„ íƒ

ëŒ€ì‹œë³´ë“œê°€ ë¹„ì–´ ë³´ì´ë©´, ìš°ì¸¡ ìƒë‹¨ ì‹œê°„ ë²”ìœ„(Last 1h/6h) ë¥¼ ë„‰ë„‰íˆ ì¡ê³  ìƒˆë¡œê³ ì¹¨.

4) ë¼ë²¨ë¡œ ì‹ë³„ì„± ê°•í™”(ì„ íƒ)

Prometheus ì„¤ì •ì— ë¼ë²¨ì„ ì¶”ê°€í•´ ë‘ë©´ ëŒ€ì‹œë³´ë“œ/ì¿¼ë¦¬ì—ì„œ VM ì‹ë³„ì´ ì‰¬ì›Œì§‘ë‹ˆë‹¤.

# /etc/prometheus/prometheus.yml (ë°œì·Œ)
- job_name: 'nodes'
  static_configs:
    - targets:
        - '221.157.174.34:9100'
      labels:
        role: 'jenkins'
        env: 'lab'


ì ìš©:

sudo systemctl reload prometheus  # ì•ˆ ë˜ë©´ restart


ëŒ€ì‹œë³´ë“œ íŒ¨ë„/ì¿¼ë¦¬ì—ì„œ role="jenkins", env="lab" í•„í„° ê°€ëŠ¥.

5) ë¹ ë¥¸ í—¬ìŠ¤ ì²´í¬

Grafana ë™ì‘

systemctl is-active grafana-server
curl -sI http://localhost:3000 | head


ë°ì´í„°ì†ŒìŠ¤ ì—°ê²°: Grafana UI â†’ Data sources â†’ Prometheus â†’ Save & test

ëŒ€ì‹œë³´ë“œ ë°ì´í„°: â€œNode Exporter Fullâ€ì—ì„œ CPU/ë©”ëª¨ë¦¬/ë””ìŠ¤í¬ ê·¸ë˜í”„ì— ë¼ì¸ì´ ë³´ì´ë©´ OK

6) ìì£¼ ì“°ëŠ” íŒ¨ë„ìš© PromQL (ë³µë¶™)

CPU ì‚¬ìš©ë¥ (%)

100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)


ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ (%)

(1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100


ë£¨íŠ¸ ë””ìŠ¤í¬ ì‚¬ìš©ë¥ (%)

(1 - (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"})) * 100


ë„¤íŠ¸ì›Œí¬ B/s

rate(node_network_receive_bytes_total[5m])
rate(node_network_transmit_bytes_total[5m])

7) íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

Grafana ì ‘ì† ë¶ˆê°€

ì„œë¹„ìŠ¤ ìƒíƒœ: sudo systemctl status grafana-server

í¬íŠ¸/ë°©í™”ë²½: ss -lntp | grep 3000, UFW/ë³´ì•ˆê·¸ë£¹ í™•ì¸

ë°ì´í„°ì†ŒìŠ¤ ì‹¤íŒ¨

Prometheus URL í™•ì¸: curl -s http://<PrometheusIP>:9091/-/ready

ë„¤íŠ¸ì›Œí¬/ë°©í™”ë²½(9091) í™•ì¸

ëŒ€ì‹œë³´ë“œ ê°’ ì—†ìŒ

Prometheus Targetsì—ì„œ nodesê°€ UPì¸ì§€ í™•ì¸

ì‹œê°„ ë²”ìœ„(Last 1h/6h) ì¡°ì •, rate(...[5m]) ë“± ë²”ìœ„ ë²¡í„° í™•ì¸

8) ë‹¤ìŒ ë‹¨ê³„(Phase 5-3 ì˜ˆê³ )

Alertmanager ì—°ë™: CPU/ë©”ëª¨ë¦¬/ë””ìŠ¤í¬ ì„ê³„ì¹˜ ì•ŒëŒ â†’ Slack/Email ì•Œë¦¼

ëŒ€ìƒ ìë™í™”: Terraform ì¶œë ¥(IP ë¦¬ìŠ¤íŠ¸)ë¡œ Prometheus targetsë¥¼ ìë™ ê°±ì‹ (file_sd)

ë¶€ë¡ A) (ì„ íƒ) Ansibleë¡œ ê°„ë‹¨ ì„¤ì¹˜

ì‹¤ìŠµì—ì„œëŠ” ìˆ˜ë™ ì„¤ì¹˜ë¡œ ì¶©ë¶„. ìë™í™”ë¥¼ ì›í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ ìµœì†Œ íƒœìŠ¤í¬ë¡œ ê°€ëŠ¥.

# ansible-test/grafana-install.yml (ì˜µì…˜)
---
- name: Install Grafana OSS (Ubuntu)
  hosts: all
  become: yes
  vars:
    ansible_user: ubuntu
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - apt:
        name: [software-properties-common, curl, gnupg]
        state: present
        update_cache: yes
    - shell: |
        install -m 0755 -d /etc/apt/keyrings
        curl -fsSL https://packages.grafana.com/gpg.key | gpg --dearmor -o /etc/apt/keyrings/grafana.gpg
        echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://packages.grafana.com/oss/deb stable main" > /etc/apt/sources.list.d/grafana.list
      args: {executable: /bin/bash}
    - apt:
        name: grafana
        state: present
        update_cache: yes
    - systemd:
        name: grafana-server
        state: started
        enabled: yes

âœ… ìš”ì•½

Grafana ì„¤ì¹˜ & ê¸°ë™(3000) â†’ Prometheus ë°ì´í„°ì†ŒìŠ¤ ë“±ë¡(9091) â†’ Node Exporter Full(1860) ëŒ€ì‹œë³´ë“œ ì„í¬íŠ¸

ì´ì œ VM ë¦¬ì†ŒìŠ¤(CPU/ë©”ëª¨ë¦¬/ë””ìŠ¤í¬/ë„¤íŠ¸ì›Œí¬) ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥!
