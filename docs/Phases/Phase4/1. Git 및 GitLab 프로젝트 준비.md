# Git 및 GitLab 프로젝트 준비

## 목표

* GitLab 서버 설치 및 접근 확인
* GitLab 프로젝트 생성 및 Git 연동
* Git 기본 개념 이해 및 브랜치 전략 수립
* 브랜치 기반 개발 워크플로우 확립
* `.gitlab-ci.yml` 자동화를 위한 기반 구축

---

## 1. GitLab 서버 설치 및 접속 확인

### 1.1 GitLab에서 프로젝트 생성

**웹 인터페이스 단계**:

1. 접속: `http://<your-ip>:8081`
2. 로그인: root 계정
3. 상단 메뉴 → **New project**
4. **Create blank project**

   * Project name: `openstack-auto`
   * Visibility: Private
   * Create 클릭

### 1.2 GitLab 설치 위치

| 환경 유형        | 설치 위치       | 설명                                                     |
| ------------ | ----------- | ------------------------------------------------------ |
| Guest VM     | **설치됨**     | DevStack 외부의 일반 Ubuntu 서버 (예: 192.168.x.x, 10.0.x.x 등) |
| OpenStack VM | **설치하지 않음** | OpenStack 위에 생성한 VM에는 설치하지 않음                          |

**설치 이유**: OpenStack 인스턴스(VM)는 Terraform/Ansible 자동화 대상이지, GitLab CI/CD 시스템 자체가 설치되는 곳이 아님

### 1.3 역할 및 위치 정리

| 역할            | 위치                | 이유                             |
| ------------- | ----------------- | ------------------------------ |
| GitLab 서버     | Guest VM          | CI/CD 중심 서버로 지속적으로 실행되어야 함     |
| GitLab Runner | Guest VM 또는 별도 VM | GitLab과 통신하여 .gitlab-ci.yml 실행 |
| OpenStack VM  | 배포 대상             | GitLab에서 생성/제어되는 대상 인프라        |

### 1.4 GitLab 설치

```bash
# 필수 패키지 설치
sudo apt update
sudo apt install -y curl openssh-server ca-certificates tzdata perl

# GitLab 저장소 등록
curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash

# GitLab 설치 (외부 접속용 포트 설정)
sudo EXTERNAL_URL="http://<your-ip>:8081" apt install gitlab-ce
```

**주의**: `EXTERNAL_URL`에는 브릿지 IP 또는 공인 IP 입력

### 1.5 포트 개방 및 확인

* OpenStack 보안 그룹에서 8081 포트 허용
* 공유기 사용 시 포트포워딩 설정 필요 (8081 → 해당 VM)

```bash
# 포트 확인
sudo ss -tuln | grep 8081
```

### 1.6 초기 비밀번호 확인 및 접속

**GitLab 초기 root 비밀번호 확인**: 설치 후 최초 1회만 사용 가능한 비밀번호 확인

```bash
sudo cat /etc/gitlab/initial_root_password
```

**접속 단계**:

1. 웹 브라우저 접속: `http://<your-ip>:8081`
2. root 계정으로 로그인
3. 비밀번호 변경
4. 관리자 설정 완료

---

## 2. Git 기본 개념 및 프로젝트 연동

### 2.1 Git이란?

* **분산 버전 관리 시스템**
* 커밋 단위로 변경사항 추적
* 브랜치로 실험/개발 분리 가능

### 2.2 브랜치 개념

* `main`: 메인 브랜치
* `dev`: 통합 개발 브랜치

### 2.3 Checkout 명령어

```bash
git checkout <브랜치>     # 브랜치 이동
git checkout -b <브랜치>  # 브랜치 생성 + 이동
```

### 2.4 GitLab 프로젝트 연동 절차

```bash
mkdir ~/openstack-auto
cd ~/openstack-auto

git init

touch README.md .gitignore
echo "# OpenStack 자동화 프로젝트" > README.md
echo ".terraform/" >> .gitignore
echo "*.tfstate*" >> .gitignore
echo "*.tfplan" >> .gitignore
echo "*.backup" >> .gitignore

# main 브랜치 생성 및 연결
git checkout -b main
git add .
git commit -m "init: main"
git remote add origin http://<your-ip>:8081/root/openstack-auto.git
git push -u origin main

# dev 브랜치 생성 및 연결
git checkout -b dev
git add .
git commit -m "init: dev"
git push -u origin dev
```

> 이후 모든 작업은 `dev` 브랜치에서 진행하고, 병합 시 `main`으로 Pull Request 수행

### 2.5 로컬 vs 원격 브랜치의 차이

| 구분     | 로컬(Local)           | 원격(Remote, GitLab)      |
| ------ | ------------------- | ----------------------- |
| 위치     | 내 컴퓨터               | GitLab 서버 (또는 GitHub 등) |
| 브랜치 생성 | 수동으로 직접 생성          | `git push`해야 생김         |
| 변경 내역  | `git commit`으로 기록   | `git push`로 전달해야 반영됨    |
| 동기화    | 명시적으로 fetch/push 필요 | 자동 연동 X                 |

> 브랜치 이름이 무엇이든 Git은 `add → commit → push` 순서를 따라야만 변경이 추적되고 반영됨

---

## 3. 병합(Merge) 작업 및 워크플로우

### 3.1 Merge Request 생성 및 병합

**GitLab 웹 인터페이스**:

1. GitLab 웹 → `Merge Requests` → `New merge request`
2. Source: `dev`
3. Target: `main`
4. Create → Merge

**또는 CLI에서 병합할 경우**:

```bash
git checkout main
git pull origin main
git merge dev
git push origin main
```

> 병합 전 반드시 main 브랜치의 최신 상태를 pull 해와야 충돌을 방지할 수 있음

---

