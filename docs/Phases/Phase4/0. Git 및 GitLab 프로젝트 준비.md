# Phase 4-0: Git 및 GitLab 프로젝트 준비

## 목표

- Git을 이해하고 브랜치 전략을 설정함
- GitLab에 프로젝트를 만들고 연동함
- Git으로 `.gitlab-ci.yml` 기반 자동화를 준비함

---

## 1. Git 기본 개념 정리

### 1.1 Git이란?

Git은 **분산 버전 관리 시스템**으로 다음과 같은 특징을 가짐:
- 파일 변경 이력(커밋)을 추적
- 여러 브랜치(branch)로 분기하여 관리 가능
- 협업을 위한 분산 환경 지원

### 1.2 브랜치(Branch) 개념

브랜치는 코드의 작업 흐름을 분리해서 실험하거나 개발할 수 있는 **독립된 공간**임

**예시 브랜치명:**
- `main` - 메인 브랜치
- `feature/terraform-setup` - 기능 개발
- `fix/nginx-port` - 버그 수정

### 1.3 Checkout 명령어

| 명령어 | 설명 |
|--------|------|
| `git checkout <브랜치>` | 해당 브랜치로 이동 |
| `git checkout -b <브랜치>` | 새로운 브랜치를 만들고 동시에 이동 |

```bash
# 새 브랜치 생성 및 이동 예시
git checkout -b feature/terraform-instance
```

### 1.4 브랜치 네이밍 컨벤션

일반적인 규칙: **`타입/기능명`**

| 타입 | 용도 | 예시 |
|------|------|------|
| `feature/` | 새로운 기능 개발 | `feature/user-auth` |
| `fix/` | 버그 수정 | `fix/login-error` |
| `hotfix/` | 긴급 수정 | `hotfix/security-patch` |
| `chore/` | 기타 작업 | `chore/update-deps` |
| `refactor/` | 코드 리팩토링 | `refactor/api-structure` |

---

## 2. Git 프로젝트 초기화 및 GitLab 연동

### 2.1 로컬 Git 초기화

```bash
# 프로젝트 디렉토리로 이동
cd ~/내프로젝트경로

# Git 저장소 초기화
git init
```

### 2.2 기본 파일 생성

```bash
# 필수 파일 생성
touch README.md .gitignore

# README.md 내용 작성
echo "# OpenStack 자동화 프로젝트" > README.md

# .gitignore 설정 (Terraform 관련)
echo ".terraform/" > .gitignore
echo "*.tfstate*" >> .gitignore
echo "*.tfplan" >> .gitignore
echo "*.backup" >> .gitignore
```

### 2.3 GitLab 프로젝트 생성

**웹 인터페이스 단계:**

1. **접속**: `http://<your-server-ip>:8081`
2. **로그인**: `root` 계정 사용
3. **프로젝트 생성**:
   - 상단 메뉴 → `New project`
   - `Create blank project` 선택
   - **Project name**: `openstack-auto`
   - **Visibility**: `Private`
   - `Create project` 클릭

### 2.4 원격 저장소 연결

```bash
# GitLab 원격 저장소 등록
git remote add origin http://<your-server-ip>:8081/root/openstack-auto.git

# 원격 저장소 확인
git remote -v
```

> **참고**: `<your-server-ip>`는 VM의 브릿지 IP나 외부에서 접근 가능한 IP로 교체

### 2.5 첫 커밋 및 푸시

```bash
# 모든 파일 스테이징
git add .

# 첫 커밋
git commit -m "init: initial project setup"

# 메인 브랜치로 푸시
git push -u origin main
```

> **주의**: GitLab의 `main` 브랜치가 보호되어 있으면 직접 푸시가 불가할 수 있음

---

## 3. 브랜치 기반 개발 전략

### 3.1 기능 브랜치 생성

```bash
# 새 기능 브랜치 생성 및 이동
git checkout -b feature/terraform-setup
```

### 3.2 작업 후 커밋

```bash
# 작업 파일들을 스테이징 영역에 추가
git add .

# 의미있는 커밋 메시지와 함께 커밋
git commit -m "feat: Terraform 인프라 코드 작성

- OpenStack provider 설정
- 인스턴스 리소스 정의
- 보안 그룹 구성"
```

### 3.3 원격 브랜치 푸시

```bash
# 원격 저장소에 브랜치 푸시
git push -u origin feature/terraform-setup
```

### 3.4 Merge Request 생성

**GitLab 웹 인터페이스:**

1. **접속**: GitLab 프로젝트 페이지
2. **Merge Request 생성**:
   - 좌측 메뉴 → `Merge requests`
   - `New merge request` 클릭
3. **브랜치 선택**:
   - **Source branch**: `feature/terraform-setup`
   - **Target branch**: `main`
4. **정보 입력**:
   - **Title**: `feat: Terraform 인프라 코드 추가`
   - **Description**: 변경사항 상세 설명
5. **생성 및 병합**:
   - `Create merge request`
   - 검토 후 `Merge` 클릭

---

## 4. GitLab Personal Access Token 설정 (옵션)

CI/CD 파이프라인에서 GitLab API를 호출해야 하는 경우 필요함

### 4.1 토큰 생성 단계

1. **프로필 설정**:
   - 우측 상단 `사용자 아이콘` → `Edit profile`
2. **Access Tokens 메뉴**:
   - 좌측 메뉴 → `Access Tokens`
3. **토큰 설정**:
   - **Name**: `ci-token`
   - **Expiration date**: 적절한 만료일 설정
   - **Scopes**: 
     - api
     - read_repository
     - write_repository
4. **토큰 생성**:
   - `Create personal access token` 클릭
   - **생성된 토큰을 안전한 곳에 보관**

### 4.2 토큰 사용 예시

```bash
# HTTPS 클론 시 토큰 사용
git clone https://oauth2:<token>@<gitlab-url>/root/openstack-auto.git

# 환경 변수로 설정
export GITLAB_TOKEN="your-personal-access-token"
```

---

## 5. 추천 Git 워크플로우

### 5.1 일반적인 개발 플로우

```bash
# 1. 최신 main 브랜치로 업데이트
git checkout main
git pull origin main

# 2. 새 기능 브랜치 생성
git checkout -b feature/new-feature

# 3. 작업 수행 후 커밋
git add .
git commit -m "feat: 새로운 기능 추가"

# 4. 원격 브랜치 푸시
git push -u origin feature/new-feature

# 5. GitLab에서 Merge Request 생성
# 6. 코드 리뷰 후 병합
# 7. 로컬에서 정리
git checkout main
git pull origin main
git branch -d feature/new-feature
```

### 5.2 커밋 메시지 컨벤션

| 타입 | 설명 | 예시 |
|------|------|------|
| `feat:` | 새로운 기능 | `feat: 사용자 인증 기능 추가` |
| `fix:` | 버그 수정 | `fix: 로그인 오류 해결` |
| `docs:` | 문서 수정 | `docs: API 문서 업데이트` |
| `style:` | 코드 스타일 변경 | `style: 코드 포맷팅 적용` |
| `refactor:` | 코드 리팩토링 | `refactor: 함수 구조 개선` |
| `test:` | 테스트 코드 | `test: 단위 테스트 추가` |
| `chore:` | 기타 작업 | `chore: 의존성 업데이트` |

---

## 6. 문제 해결 가이드

### 6.1 자주 발생하는 문제들

**문제 1**: `main` 브랜치에 직접 푸시 불가
```bash
# 해결: 브랜치를 통한 Merge Request 사용
git checkout -b hotfix/urgent-fix
git push -u origin hotfix/urgent-fix
# GitLab에서 Merge Request 생성
```

**문제 2**: 원격 저장소 연결 오류
```bash
# 현재 원격 저장소 확인
git remote -v

# 잘못된 URL 수정
git remote set-url origin http://<correct-ip>:8081/root/openstack-auto.git
```

**문제 3**: 인증 오류
```bash
# Personal Access Token 사용
git remote set-url origin https://oauth2:<token>@<gitlab-url>/root/openstack-auto.git
```

### 6.2 유용한 Git 명령어

```bash
# 브랜치 목록 확인
git branch -a

# 현재 상태 확인
git status

# 커밋 히스토리 확인
git log --oneline

# 변경사항 확인
git diff

# 스테이징 영역 초기화
git reset

# 마지막 커밋 수정
git commit --amend
```

---

> **다음 단계**: 이제 Git과 GitLab 설정이 완료되었으므로, Terraform 코드를 작성하고 CI/CD 파이프라인을 구성할 수 있음
