# GitLab Runner 설치 및 등록 가이드

## 개요
이 단계에서는 GitLab에서 정의한 `.gitlab-ci.yml` 파이프라인을 실행할 수 있도록 **GitLab Runner**를 설치하고, GitLab 프로젝트에 등록하는 과정을 진행합니다. Runner는 CI/CD 파이프라인의 명령어를 실제로 수행하는 역할을 담당합니다.

## 실행 환경

| 항목 | 내용 |
|------|------|
| **GitLab 설치 위치** | DevStack 외부 Ubuntu (예: `192.168.x.x`) |
| **Runner 설치 위치** | GitLab이 설치된 동일한 서버 또는 별도 서버 |
| **OS** | Ubuntu 20.04+ 기준 |

## 1. GitLab Runner 설치

### 1.1 공식 저장소 추가
```bash
# GitLab Runner 공식 저장소 추가
curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash
```

### 1.2 GitLab Runner 설치
```bash
# GitLab Runner 설치
sudo apt-get install gitlab-runner -y
```

### 1.3 설치 확인
```bash
# 설치 확인
gitlab-runner --version

# 서비스 상태 확인
sudo systemctl status gitlab-runner
```

## 2. Runner 등록

### 2.1 등록 명령어 실행
```bash
sudo gitlab-runner register
```

### 2.2 등록 시 입력 정보

| 질문 | 입력 예시 | 설명 |
|------|----------|------|
| **GitLab 인스턴스 URL** | `http://<your-gitlab-ip>:8081/` | GitLab 서버 주소 |
| **Registration token** | `glrt-xxxxxxxxxxxx` | GitLab 프로젝트에서 확인 |
| **Description** | `openstack-runner` | Runner 식별용 이름 |
| **Tags** | `terraform, ansible` | 파이프라인 필터링용 (선택) |
| **Executor** | `shell` | 로컬 실행용 |

### 2.3 Registration Token 확인 방법

**GitLab 웹 인터페이스에서 확인**:
1. GitLab 프로젝트 접속
2. **Settings** → **CI/CD** 메뉴
3. **Runners** 섹션 확장
4. **Project runners** 하단의 **Registration token** 복사

## 3. Runner 등록 확인

### 3.1 웹 UI에서 확인
1. GitLab 프로젝트 접속
2. **Settings** → **CI/CD** → **Runners**
3. **Available specific runners** 섹션에서 등록된 Runner 확인

### 3.2 CLI에서 확인
```bash
# 등록된 Runner 목록 확인
sudo gitlab-runner list

# Runner 상태 확인
sudo gitlab-runner status
```

## 4. Runner 관리

### 4.1 Runner 시작/중지
```bash
# Runner 서비스 시작
sudo systemctl start gitlab-runner

# Runner 서비스 중지
sudo systemctl stop gitlab-runner

# Runner 서비스 재시작
sudo systemctl restart gitlab-runner

# 부팅 시 자동 시작 설정
sudo systemctl enable gitlab-runner
```

### 4.2 Runner 설정 확인
```bash
# Runner 설정 파일 확인
sudo cat /etc/gitlab-runner/config.toml
```

## 5. Executor 유형별 특징

### 5.1 Shell Executor (권장)
**장점**:
- 설정이 간단함
- 로컬 환경 직접 사용
- 별도 컨테이너 환경 불필요

**단점**:
- 호스트 시스템에 직접 영향
- 격리성이 낮음

### 5.2 Docker Executor (선택사항)
**장점**:
- 격리된 실행 환경
- 일관된 빌드 환경

**단점**:
- Docker 설치 필요
- 설정이 복잡함

## 6. 트러블슈팅

### 6.1 일반적인 문제

**Runner가 Jobs를 실행하지 않는 경우**:
```bash
# Runner 로그 확인
sudo journalctl -u gitlab-runner -f

# Runner 재등록
sudo gitlab-runner unregister --all-runners
sudo gitlab-runner register
```

**권한 문제 해결**:
```bash
# gitlab-runner 사용자 권한 확인
sudo usermod -aG sudo gitlab-runner

# 특정 디렉터리 권한 부여
sudo chown -R gitlab-runner:gitlab-runner /path/to/project
```

