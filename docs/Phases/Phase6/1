Phase 6-1: 트래픽 생성 & 장애 주입 실습
0. 준비 사항

Jenkins 서버 접근 가능 (웹 UI 및 SSH)

OpenStack VM(서비스 대상) Floating IP 확인 (예: http://220.xxx.xxx.xxx/)

Prometheus / Grafana / Alertmanager 설치 완료 (탐지는 6-2에서 확인할 예정)

1. Jenkins 서버에 부하 도구 설치

가장 간단한 ApacheBench (ab) 사용:

sudo apt-get update
sudo apt-get install -y apache2-utils
ab -V   # 설치 확인

2. Jenkins에서 Job 생성

Jenkins 접속 → New Item → Freestyle project 선택

이름: load-test

This project is parameterized 체크

String Parameter → 이름: TARGET_URL, 기본값: http://<FLOATING_IP>/

String Parameter → 이름: TOTAL, 기본값: 10000

String Parameter → 이름: CONCURRENCY, 기본값: 100

Build Steps → Execute shell 입력:

ab -n ${TOTAL} -c ${CONCURRENCY} ${TARGET_URL}


저장 후 Build 실행

✅ Jenkins 콘솔 출력에서 Requests/sec, Failed requests, Latency 확인 가능

3. 장애 주입 (부하 중 or 직후 실행)

Jenkins에서 부하가 진행 중일 때, Nginx VM에 SSH 접속해서 장애를 유발합니다.

(A) 서비스 다운
sudo systemctl stop nginx

(B) 포트 차단
sudo iptables -I INPUT -p tcp --dport 80 -j DROP

(C) CPU 스파이크
timeout 60 bash -c 'while :; do :; done' &

4. 장애 복구

서비스 복구

sudo systemctl start nginx


iptables 규칙 제거

sudo iptables -D INPUT -p tcp --dport 80 -j DROP
